<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background-color: #f5f5f5;
    }
    header {
        background-color: #001F3F;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    header h1 {
        margin: 0;
    }
    .stats {
        display: flex;
        justify-content: space-around;
        margin: 20px;
    }
    .stat-box {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 5px rgba(0,0,0,0.2);
        flex: 1;
        margin: 0 10px;
        text-align: center;
    }
    .collapse-section {
        background: white;
        margin: 20px;
        border-radius: 8px;
        padding: 15px;
        display: none;
        box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .subject-buttons {
        display: flex;
        flex-wrap: wrap;
        margin: 20px;
    }
    .subject-buttons button {
        background-color: #001F3F;
        color: white;
        padding: 10px;
        margin: 5px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
    .subject-buttons button:hover {
        background-color: #003366;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: center;
    }
    tr.green {
        background-color: #c8e6c9;
    }
    tr.red {
        background-color: #ffcdd2;
    }
    tr.gray {
        background-color: #e0e0e0;
    }
    .btn {
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .btn-green { background: green; color: white; }
    .btn-red { background: red; color: white; }
    .btn-gray { background: gray; color: white; }
</style>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

<header>
    <h1>My School Name</h1>
    <div>
        <button class="btn btn-green" onclick="logout()">Logout</button>
    </div>
</header>

<div class="stats">
    <div class="stat-box">
        <h2 id="subjectCount">0</h2>
        <p>Subjects</p>
    </div>
    <div class="stat-box">
        <h2 id="classCount">0</h2>
        <p>Classes</p>
    </div>
    <div class="stat-box">
        <h2 id="studentCount">0</h2>
        <p>Students</p>
    </div>
</div>

<div id="formMasterSection" class="collapse-section">
    <h3>You're the form master for: <span id="formMasterClass"></span></h3>
    <table id="formMasterTable">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Status</th>
                <th>View</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="subject-buttons" id="subjectButtons"></div>

<div id="scoreSheetSection" class="collapse-section">
    <h3 id="scoreSheetTitle"></h3>
    <table id="scoreSheetTable">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>1st CA</th>
                <th>2nd CA</th>
                <th>3rd CA</th>
                <th>Total CA</th>
                <th>Exam</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button class="btn btn-green" onclick="saveScores()">Save All</button>
</div>

<script>
const supabaseUrl = "https://mhxaxxhhpyjujroyjzzl.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oeGF4eGhocHlqdWpyb3lqenpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2OTY0NjUsImV4cCI6MjA3MDI3MjQ2NX0.G1rcTI9mhr4euCw8RakmSmzNJlPkGpQPkNx49PsEUWY";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

let teacherId = 1; // Replace with logged-in teacher ID
let currentSubjectId = null;

async function logout() {
    alert("Logging out...");
}

function calcTotals(row) {
    const ca1 = parseInt(row.querySelector(".ca1").value) || 0;
    const ca2 = parseInt(row.querySelector(".ca2").value) || 0;
    const ca3 = parseInt(row.querySelector(".ca3").value) || 0;
    const exam = parseInt(row.querySelector(".exam").value) || 0;
    row.querySelector(".totalCA").textContent = ca1 + ca2 + ca3;
    row.querySelector(".total").textContent = (ca1 + ca2 + ca3) + exam;
}

async function loadDashboard() {
    // TODO: Replace with actual Supabase queries to populate dashboard
    document.getElementById("subjectCount").textContent = 3;
    document.getElementById("classCount").textContent = 2;
    document.getElementById("studentCount").textContent = 60;

    document.getElementById("formMasterSection").style.display = "block";
    document.getElementById("formMasterClass").textContent = "SS1A1";
}

function openScoreSheet(subjectId, subjectName) {
    currentSubjectId = subjectId;
    document.getElementById("scoreSheetTitle").textContent = subjectName;
    document.getElementById("scoreSheetSection").style.display = "block";

    const tbody = document.querySelector("#scoreSheetTable tbody");
    tbody.innerHTML = "";
    for (let i = 1; i <= 10; i++) {
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>Student ${i}</td>
            <td><input type="number" class="ca1" min="0" max="10" oninput="calcTotals(this.closest('tr'))"></td>
            <td><input type="number" class="ca2" min="0" max="10" oninput="calcTotals(this.closest('tr'))"></td>
            <td><input type="number" class="ca3" min="0" max="10" oninput="calcTotals(this.closest('tr'))"></td>
            <td class="totalCA">0</td>
            <td><input type="number" class="exam" min="0" max="70" oninput="calcTotals(this.closest('tr'))"></td>
            <td class="total">0</td>
            <td><button class="btn btn-gray" onclick="toggleOffering(this)">Not offering</button></td>
        `;
        tbody.appendChild(tr);
    }
}

function toggleOffering(btn) {
    const row = btn.closest("tr");
    if (row.classList.contains("gray")) {
        row.classList.remove("gray");
        btn.textContent = "Not offering";
        btn.className = "btn btn-gray";
    } else {
        row.classList.add("gray");
        btn.textContent = "Offering";
        btn.className = "btn btn-green";
    }
}

function saveScores() {
    alert("Scores saved (demo)");
}

window.onload = loadDashboard;
</script>

</body>
</html>
